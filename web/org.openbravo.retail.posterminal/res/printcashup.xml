<?xml version="1.0" encoding="UTF-8"?>
<!--
 ************************************************************************************
 * Copyright (C) 2013-2021 Openbravo S.L.U.
 * Licensed under the Openbravo Commercial License version 1.0
 * You may obtain a copy of the License at http://www.openbravo.com/legal/obcl.html
 * or in the legal folder of this module distribution.
 ************************************************************************************
-->

<output>
  <ticket>
    <line>
        <image>ticket-image.png</image>
    </line>
    <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_CashUpRpt_Title')) %></text>
    </line>
    <line>    
    <% if (cashup.closed) { %>
      <text align="center" length="42" bold="true"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_CashUpRpt_Closed')) %></text>
    <% } else { %>
      <text align="center" length="42" bold="true"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_CashUpRpt_Partial')) %></text>        
    <% } %>    
    </line>
    <line></line>
    <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_LblStore') + ': ' + OB.App.TerminalProperty.get('terminal').organization$_identifier) %></text>
    </line>
    <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_LblTerminal') + ': ' + OB.App.TerminalProperty.get('terminal')._identifier) %></text>
    </line>
        <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_LblUser') + ': ' + OB.App.TerminalProperty.get('context').user._identifier) %></text>
    </line>
    <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_LblOpenTime') + ': ' + OB.I18N.formatDate(new Date(cashup.report.creationDate)) + ' - ' + OB.I18N.formatHour(new Date(cashup.report.creationDate))) %></text>
    </line>     
    <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_LblCloseTime') + ': ' + OB.I18N.formatDate(cashup.report.time) + ' - ' + OB.I18N.formatHour(cashup.report.time)) %></text>
    </line>  
    <line></line>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblNetSales'), 27, OB.App.PrintUtils.printAmount(cashup.report.netSales), 14) %>
    <%
    (cashup.report.salesTaxes || []).forEach(function(tax) {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(tax.name, 27, OB.App.PrintUtils.printAmount(tax.amount), 14) %>
    <%
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblGrossSales'), 27, OB.App.PrintUtils.printAmount(cashup.report.grossSales), 14, true) %>
    <line></line>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblNetReturns'), 27, OB.App.PrintUtils.printAmount(cashup.report.netReturns), 14) %>
    <%
    (cashup.report.returnsTaxes || []).forEach(function(tax) {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(tax.name, 27, OB.App.PrintUtils.printAmount(tax.amount), 14) %>
    <%
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblGrossReturns'), 27, OB.App.PrintUtils.printAmount(cashup.report.grossReturns), 14, true) %>
    <line></line>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel((OB.App.TerminalProperty.get('terminal').ismaster || OB.App.TerminalProperty.get('terminal').isslave) ? 'OBPOS_LblTotalRetailTransLocalPrint' : 'OBPOS_LblTotalRetailTrans'), 27, OB.App.PrintUtils.printAmount(cashup.report.totalRetailTransactions), 14, true) %>
    <line></line>
    <%
    (cashup.report.startings || []).forEach(function(starting) {
      if (starting.amount !== starting.origAmount && starting.countInCashup) {
    %>
      <line>
        <text align="left" length="18"><%=OB.UTIL.encodeXMLComponent(starting.description) %></text>
        <text align="right" length="12"><%= '(' + OB.App.PrintUtils.printAmount(starting.amount) + ' ' + starting.isocode + ')' %></text>
        <text align="right" length="10"><%= OB.App.PrintUtils.printAmount(OB.DEC.mul(starting.amount, starting.rate)) %></text>
      </line>
    <%
      } else if(starting.countInCashup) {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(starting.description, 27, OB.App.PrintUtils.printAmount(OB.DEC.mul(starting.amount, starting.rate)), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalStarting'), 27, OB.App.PrintUtils.printAmount(cashup.report.totalStartings), 14, true) %>
    <line></line>
    <%
    (cashup.report.drops || []).forEach(function(drop) {
      if (drop.amount !== drop.origAmount && drop.countInCashup) {
    %>
      <line>
        <text align="left" length="15"><%=OB.UTIL.encodeXMLComponent(drop.description) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(drop.amount) + ' ' + drop.isocode + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(drop.origAmount) %></text>
      </line>
    <%
      } else if(drop.countInCashup){
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(drop.description, 27, OB.App.PrintUtils.printAmount(drop.amount), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalWithdrawals'), 27, OB.App.PrintUtils.printAmount(cashup.report.totalDrops), 14, true) %>
    <line></line>
    <%
    (cashup.report.deposits || []).forEach(function(deposit) {
      if (deposit.amount !== deposit.origAmount && deposit.countInCashup) {
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(deposit.description) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(deposit.amount) + ' ' + deposit.isocode + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(deposit.origAmount) %></text>
      </line>
    <%
      } else if(deposit.countInCashup) {
     %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(deposit.description, 27, OB.App.PrintUtils.printAmount(deposit.amount), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalDeposits'), 27, OB.App.PrintUtils.printAmount(cashup.report.totalDeposits), 14, true) %>
    <line>
    </line>
    <%
    (cashup.summary.expectedSummary || []).forEach(function(payment) {
      if(payment.second && payment.second !== payment.value){
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(payment.name) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(payment.second) + ' ' + payment.isocode + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(payment.value) %></text>
      </line>
    <%
      } else {
     %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(payment.name,27,OB.App.PrintUtils.printAmount(payment.value),14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalExpected'), 27, OB.App.PrintUtils.printAmount(cashup.summary.totalExpected), 14, true) %>
    <line>
    </line>
    <%
    if (!cashup.summary.isPartialCashup) {
    (cashup.summary.countedSummary || []).forEach(function(payment) {
      if (payment.second && payment.second !== payment.value) {
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(payment.name) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(payment.second) + ' ' + payment.isocode + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(payment.value) %></text>
      </line>
    <%
      } else {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(payment.name, 27, OB.App.PrintUtils.printAmount(payment.value), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalCounted'), 27, OB.App.PrintUtils.printAmount(cashup.summary.totalCounted), 14, true) %>
    <line></line>
    <%
    (cashup.summary.differenceSummary || []).forEach(function(payment) {
      if (payment.second && payment.second !== payment.value) {
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(payment.name) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(payment.second) + ' ' + payment.isocode + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(payment.value) %></text>
      </line>
    <% 
      } else {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(payment.name, 27, OB.App.PrintUtils.printAmount(payment.value), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalDifference'), 27, OB.App.PrintUtils.printAmount(cashup.summary.totalDifference), 14, true) %>
    <line></line>
    <%
    (cashup.summary.qtyToKeepSummary || []).forEach(function(payment) {
      if (payment.second && payment.second !== payment.value) {
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(payment.name) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(payment.second) + ' ' + payment.isocode + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(payment.value) %></text>
      </line>
    <%
      } else {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(payment.name, 27, OB.App.PrintUtils.printAmount(payment.value), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalQtyToKeep'), 27, OB.App.PrintUtils.printAmount(cashup.summary.totalQtyToKeep), 14, true) %>
    <line></line>
    <%
    (cashup.summary.qtyToDepoSummary || []).forEach(function(payment) {
      if (payment.second && payment.second !== payment.value) {
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(payment.name) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(payment.second) + ' ' + payment.isocode + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(payment.value) %></text>
      </line>
    <%
      } else {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(payment.name, 27, OB.App.PrintUtils.printAmount(payment.value), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalQtyToDepo'), 27, OB.App.PrintUtils.printAmount(cashup.summary.totalQtyToDepo), 14, true) %>
    <line></line>
    <%
    }
    %>
  </ticket>
</output>
