<?xml version="1.0" encoding="UTF-8"?>
<!--
 ************************************************************************************
 * Copyright (C) 2013-2021 Openbravo S.L.U.
 * Licensed under the Openbravo Commercial License version 1.0
 * You may obtain a copy of the License at http://www.openbravo.com/legal/obcl.html
 * or in the legal folder of this module distribution.
 ************************************************************************************
-->

<output>
  <ticket>
    <line>
        <image>ticket-image.png</image>
    </line>
    <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_CashUpRpt_Title')) %></text>
    </line>
    <line>    
    <% if (cashup.closed) { %>
      <text align="center" length="42" bold="true"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_CashUpRpt_Closed')) %></text>
    <% } else { %>
      <text align="center" length="42" bold="true"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_CashUpRpt_Partial')) %></text>        
    <% } %>    
    </line>
    <line></line>
    <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_LblStore') + ': ' + OB.App.TerminalProperty.get('terminal').organization$_identifier) %></text>
    </line>
    <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_LblTerminal') + ': ' + OB.App.TerminalProperty.get('terminal')._identifier) %></text>
    </line>
        <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_LblUser') + ': ' + OB.App.TerminalProperty.get('context').user._identifier) %></text>
    </line>
    <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_LblOpenTime') + ': ' + OB.I18N.formatDate(new Date(cashup.report.get('creationDate'))) + ' - ' + OB.I18N.formatHour(new Date(cashup.report.get('creationDate')))) %></text>
    </line>     
    <line>
      <text align="center" length="42"><%= OB.UTIL.encodeXMLComponent(OB.I18N.getLabel('OBPOS_LblCloseTime') + ': ' + OB.I18N.formatDate(cashup.report.get('time')) + ' - ' + OB.I18N.formatHour(cashup.report.get('time'))) %></text>
    </line>  
    <line></line>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblNetSales'), 27, OB.App.PrintUtils.printAmount(cashup.report.get('netSales')), 14) %>
    <%
    (cashup.report.get('salesTaxes') || []).forEach(function(tax) {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(tax.get('name'), 27, OB.App.PrintUtils.printAmount(tax.get('amount')), 14) %>
    <%
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblGrossSales'), 27, OB.App.PrintUtils.printAmount(cashup.report.get('grossSales')), 14, true) %>
    <line></line>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblNetReturns'), 27, OB.App.PrintUtils.printAmount(cashup.report.get('netReturns')), 14) %>
    <%
    (cashup.report.get('returnsTaxes') || []).forEach(function(tax) {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(tax.get('name'), 27, OB.App.PrintUtils.printAmount(tax.get('amount')), 14) %>
    <%
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblGrossReturns'), 27, OB.App.PrintUtils.printAmount(cashup.report.get('grossReturns')), 14, true) %>
    <line></line>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel((OB.App.TerminalProperty.get('terminal').ismaster || OB.App.TerminalProperty.get('terminal').isslave) ? 'OBPOS_LblTotalRetailTransLocalPrint' : 'OBPOS_LblTotalRetailTrans'), 27, OB.App.PrintUtils.printAmount(cashup.report.get('totalRetailTransactions')), 14, true) %>
    <line></line>
    <%
    (cashup.report.get('startings') || []).forEach(function(starting) {
      if (starting.get('amount') !== starting.get('origAmount') && starting.get('countInCashup')) {
    %>
      <line>
        <text align="left" length="18"><%=OB.UTIL.encodeXMLComponent(starting.get('description')) %></text>
        <text align="right" length="12"><%= '(' + OB.App.PrintUtils.printAmount(starting.get('amount')) + ' ' + starting.get('isocode') + ')' %></text>
        <text align="right" length="10"><%= OB.App.PrintUtils.printAmount(OB.DEC.mul(starting.get('amount'), starting.get('rate'))) %></text>
      </line>
    <%
      } else if(starting.get('countInCashup')) {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(starting.get('description'), 27, OB.App.PrintUtils.printAmount(OB.DEC.mul(starting.get('amount'), starting.get('rate'))), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalStarting'), 27, OB.App.PrintUtils.printAmount(cashup.report.get('totalStartings')), 14, true) %>
    <line></line>
    <%
    (cashup.report.get('drops') || []).forEach(function(drop) {
      if (drop.get('amount') !== drop.get('origAmount') && drop.get('countInCashup')) {
    %>
      <line>
        <text align="left" length="15"><%=OB.UTIL.encodeXMLComponent(drop.get('description')) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(drop.get('amount')) + ' ' + drop.get('isocode') + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(drop.get('origAmount')) %></text>
      </line>
    <%
      } else if(drop.get('countInCashup')){
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(drop.get('description'), 27, OB.App.PrintUtils.printAmount(drop.get('amount')), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalWithdrawals'), 27, OB.App.PrintUtils.printAmount(cashup.report.get('totalDrops')), 14, true) %>
    <line></line>
    <%
    (cashup.report.get('deposits') || []).forEach(function(deposit) {
      if (deposit.get('amount') !== deposit.get('origAmount') && deposit.get('countInCashup')) {
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(deposit.get('description')) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(deposit.get('amount')) + ' ' + deposit.get('isocode') + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(deposit.get('origAmount')) %></text>
      </line>
    <%
      } else if(deposit.get('countInCashup')) {
     %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(deposit.get('description'), 27, OB.App.PrintUtils.printAmount(deposit.get('amount')), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalDeposits'), 27, OB.App.PrintUtils.printAmount(cashup.report.get('totalDeposits')), 14, true) %>
    <line>
    </line>
    <%
    (cashup.summary.expectedSummary || []).forEach(function(payment) {
      if(payment.get('second') && payment.get('second')!==payment.get('value')){
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(payment.get('name')) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(payment.get('second')) + ' ' + payment.get('isocode') + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(payment.get('value')) %></text>
      </line>
    <%
      } else {
     %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(payment.get('name'),27,OB.App.PrintUtils.printAmount(payment.get('value')),14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalExpected'), 27, OB.App.PrintUtils.printAmount(cashup.summary.totalExpected), 14, true) %>
    <line>
    </line>
    <%
    if (!cashup.summary.isPartialCashup) {
    (cashup.summary.countedSummary || []).forEach(function(payment) {
      if (payment.get('second') && payment.get('second') !== payment.get('value')) {
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(payment.get('name')) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(payment.get('second')) + ' ' + payment.get('isocode') + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(payment.get('value')) %></text>
      </line>
    <%
      } else {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(payment.get('name'), 27, OB.App.PrintUtils.printAmount(payment.get('value')), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalCounted'), 27, OB.App.PrintUtils.printAmount(cashup.summary.totalCounted), 14, true) %>
    <line></line>
    <%
    (cashup.summary.differenceSummary || []).forEach(function(payment) {
      if (payment.get('second') && payment.get('second')!==payment.get('value')) {
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(payment.get('name')) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(payment.get('second')) + ' ' + payment.get('isocode') + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(payment.get('value')) %></text>
      </line>
    <% 
      } else {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(payment.get('name'), 27, OB.App.PrintUtils.printAmount(payment.get('value')), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalDifference'), 27, OB.App.PrintUtils.printAmount(cashup.summary.totalDifference), 14, true) %>
    <line></line>
    <%
    (cashup.summary.qtyToKeepSummary || []).forEach(function(payment) {
      if (payment.get('second') && payment.get('second') !== payment.get('value')) {
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(payment.get('name')) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(payment.get('second')) + ' ' + payment.get('isocode') + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(payment.get('value')) %></text>
      </line>
    <%
      } else {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(payment.get('name'), 27, OB.App.PrintUtils.printAmount(payment.get('value')), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalQtyToKeep'), 27, OB.App.PrintUtils.printAmount(cashup.summary.totalQtyToKeep), 14, true) %>
    <line></line>
    <%
    (cashup.summary.qtyToDepoSummary || []).forEach(function(payment) {
      if (payment.get('second') && payment.get('second') !== payment.get('value')) {
    %>
      <line>
        <text align="left" length="15"><%= OB.UTIL.encodeXMLComponent(payment.get('name')) %></text>
        <text align="right" length="15"><%= '(' + OB.App.PrintUtils.printAmount(payment.get('second')) + ' ' + payment.get('isocode') + ')' %></text>
        <text align="right" length="11"><%= OB.App.PrintUtils.printAmount(payment.get('value')) %></text>
      </line>
    <%
      } else {
    %>
      <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(payment.get('name'), 27, OB.App.PrintUtils.printAmount(payment.get('value')), 14) %>
    <%
      }
    });
    %>
    <%= OB.UTIL.encodeXMLMultiLineComponentWithValue(OB.I18N.getLabel('OBPOS_LblTotalQtyToDepo'), 27, OB.App.PrintUtils.printAmount(cashup.summary.totalQtyToDepo), 14, true) %>
    <line></line>
    <%
    }
    %>
  </ticket>
</output>
