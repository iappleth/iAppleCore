<?xml version="1.0"?>
  <database name="FUNCTION OBPOS_FIXISSUE26444">
    <function name="OBPOS_FIXISSUE26444" type="NULL">
      <body><![CDATA[BEGIN
-- UPDATE THE INVOICE TOTAL PAID AND ISPAID
update c_invoice i set totalpaid=grandtotal, ispaid='Y', outstandingamt=0
where i.grandtotal = 0 and exists (
 select 1 from fin_payment_schedule ps 
 where ps.c_invoice_id = i.c_invoice_id
);
-- UPDATE THE SCHEDULED DETAILS LINKED TO THE PAYMENT SCHEDULE TO BE DELETED
update fin_payment_scheduledetail psd set fin_payment_schedule_invoice = null where psd.fin_payment_schedule_invoice in (
	select ps.fin_payment_schedule_id from fin_payment_schedule ps where exists 
	(
		select 1
		from c_invoice i 
		where 1=1
		and ps.c_invoice_id = i.c_invoice_id 
		and i.grandtotal = 0 
	)
);
-- DELETE THE PAYMENT SCHEDULED OF THE INVOICE	
delete from fin_payment_schedule ps where exists 
	(
		select 1
		from c_invoice i 
		where 1=1
		and ps.c_invoice_id = i.c_invoice_id 
		and i.grandtotal = 0 
	);

EXCEPTION
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('Error fixing data off issue 26444');
END OBPOS_FIXISSUE26444
]]></body>
    </function>
  </database>
